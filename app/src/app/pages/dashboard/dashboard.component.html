<div class="page-title">
  <h1><strong>DASHBOARD</strong></h1>
  <div class="add-device-button">
    <button mat-raised-button color="primary">
      <mat-icon>refresh</mat-icon><span>Refresh</span>
    </button>
  </div>
</div>
<mat-divider></mat-divider>
<br>

<div class="cards-container">
  <!-- Card for User Device Count -->
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>Devices</mat-card-title>
      <mat-card-subtitle>Total devices registered</mat-card-subtitle>
      <div class="dashboard-card-data-container">
        <mat-icon class="dashboard-card-data-icon">screenshot</mat-icon>
        <h1 class="dashboard-card-data-number">{{counters[0]?.total_devices}}</h1>
      </div>
    </mat-card-header>
    <mat-card-content>
    </mat-card-content>
  </mat-card>

  <!-- Card for Total Consumption Count -->
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>Consumption</mat-card-title>
      <mat-card-subtitle>Total consumption recorded</mat-card-subtitle>
      <div class="dashboard-card-data-container">
        <mat-icon class="dashboard-card-data-icon">power</mat-icon>
        <h1 class="dashboard-card-data-number">{{counters[0]?.total_consumptions}}</h1>
      </div>
    </mat-card-header>
    <mat-card-content>
    </mat-card-content>
  </mat-card>

  <!-- Card for Total Alert Count -->
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>Alerts</mat-card-title>
      <mat-card-subtitle>Total alerts issued</mat-card-subtitle>
      <div class="dashboard-card-data-container">
        <mat-icon class="dashboard-card-data-icon">notifications</mat-icon>
        <h1 class="dashboard-card-data-number">{{counters[0]?.total_alerts}}</h1>
      </div>
    </mat-card-header>
    <mat-card-content>
    </mat-card-content>
  </mat-card>
</div>

<!-- PANEL 2 -->
<div class="cards-container-charts">
  <!-- Card for Chart 1 -->
  <mat-card class="dashboard-card-chart">
    <button mat-icon-button [matMenuTriggerFor]="totalPowerChartMenu" class="menu-button"
      (click)="$event.stopPropagation()">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #totalPowerChartMenu class="chart-menu">
      <button mat-menu-item (click)="setChartType(false)">
        <mat-icon>speaker</mat-icon><span>Per Device</span>
      </button>
      <button mat-menu-item (click)="setChartType(true)">
        <mat-icon>category</mat-icon><span>Per Device Category</span>
      </button>

    </mat-menu>
    <mat-card-header>
      <mat-card-title>Total Power</mat-card-title>
      <mat-card-subtitle>Total power consumed per device</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <br>
      <!-- Consumption Chart -->
      <div *ngIf="!showGroupedChart">
        <div *ngIf="totalPower && totalPower.length > 0 && !showGroupedChart ; else noPowerReadingsContent">
          <ngx-charts-bar-vertical [results]="totalPower" [xAxis]="true" [yAxis]="true"
            [legend]="true" [legendTitle]="'Device List'" [showXAxisLabel]="true" [showYAxisLabel]="true"
            [gradient]="true" xAxisLabel="Device" yAxisLabel="Total Power (Watts)">
          </ngx-charts-bar-vertical>
        </div>
      </div>
      
      <div *ngIf="showGroupedChart">
        <div *ngIf="totalPowerGrouped && totalPowerGrouped.length > 0; else noPowerReadingsContent">
          <ngx-charts-bar-vertical-stacked [results]="totalPowerGrouped" [xAxis]="true" [yAxis]="true"
            [legend]="true" [legendTitle]="'Device'" [showXAxisLabel]="true" [showYAxisLabel]="true"
            [gradient]="true" xAxisLabel="Category" yAxisLabel="Total Power (Watts)">
          </ngx-charts-bar-vertical-stacked>
        </div>
      </div>
      
      <ng-template #noPowerReadingsContent>
        <h3 align="center" class="rounded-label">No data available</h3>
      </ng-template>
    </mat-card-content>
  </mat-card>

  <!-- Card for Chart 2 -->
  <mat-card class="dashboard-card-chart">
    <mat-card-header>
      <mat-card-title>Card Title 2</mat-card-title>
      <mat-card-subtitle>Subtitle</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
    </mat-card-content>
  </mat-card>

  <!-- PANEL 3 -->
  <mat-card class="dashboard-card-chart">
    <mat-card-header>
      <mat-card-title>Card Title 1</mat-card-title>
      <mat-card-subtitle>Subtitle</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
    </mat-card-content>
  </mat-card>
</div>